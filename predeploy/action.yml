name: Execute predeploy steps
description: Execute predeploy steps

inputs:
  github-token:
    description: |
      Token with which to check the code freeze status.
      If not provided, will skip the code freeze check
    required: false
    default: ''
  working-directory:
    description: Directory to run the pipeline in
    required: false
    default: '.'

runs:
  using: composite
  steps:
    - uses: stampedeapp/actions/check-code-freeze@monorepo
      if: ${{ inputs.github-token != '' }}
      with:
        github-token: ${{ inputs.github-token }}
    - uses: stampedeapp/actions/setup@monorepo
      with:
        working-directory: ${{ inputs.working-directory }}
    - id: predeploy
      name: Check for predeploy script
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: echo "script=$(cat package.json | jq -r .scripts.predeploy)" >> $GITHUB_OUTPUT
    - shell: bash
      if: ${{ steps.predeploy.outputs.script != 'null' }}
      name: Run predeploy script
      working-directory: ${{ inputs.working-directory }}
      run: yarn predeploy
